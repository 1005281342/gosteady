## 开放讨论

### 为什么Kafka不像MySQL那样允许追随者副本对外提供读服务？

1. 为什么MySQL的从库（副本）需要对外提供读服务？使用MySQL的应用在大多数情况下是读多写少的，MySQL本身也是读写分离架构，所以可以让从库对外提供读服务来减少主库读压力（主从复制存在延迟，如果对数据敏感的业务则应指定读库数据）。

2. 为什么Kafka不采用读写分离架构？读写分离架构更适用于`读多写少`的场景，Kafka是消息引擎很少应用于`读写分离`场景

3. Kafka采用的是什么架构？采用的是三层消息架构

   - 第一层是主题层，每个主题可以配置M个分区，每个分区又可以设置N个副本
   - 第二层是分区层，每个分区的N个副本只有一个可以充当领导者角色，对外提供服务；其他N-1个副本是追随者副本，作提供数据冗余之用。
   - 第三层是消息层，分区中包含若干条消息，每条消息的位移从0开始，依次递增。

   设置主题层是方便消息订阅。设置分区层是支持可通过横向扩容来提升吞吐量。对于分区下的消息层则保持顺序消费。

对于消息引擎来说，对于每条生产（写）的数据一般情况下将会进行一次消费（读）。并不像MySQL那样主要服务于读多写少的场景，领导者数据及其副本基本可以满足读需求。如果追随者副本也对外提供读服务将存在数据一致性问题，代码实现将变更复杂。其次三层消息架构本身就可以通过分区功能和多broker部署，将一个topic的数据负载（备份）到多个broker上，减轻了单台机器的读写压力并支持横向扩展，所以对于追随者副本来说没有必要提供读服务。

**参考**：

https://www.zhihu.com/question/327925275/answer/705690755

https://blog.csdn.net/weiaiyisheng_ljj/article/details/102913395

https://zhuanlan.zhihu.com/p/452942396