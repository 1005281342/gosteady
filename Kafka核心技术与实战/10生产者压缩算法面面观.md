## 压缩

空间换时间的思想，以较小的CPU开销带来更少的磁盘占用或更少的网络I/O传输。



## Kafka中怎么压缩

V1版本中保存压缩消息的方法是把多条消息进行压缩然后保存到外层消息的消息体字段中；V2版本则是对整个消息集合对象进行压缩。



## 何时压缩

压缩可能发生在两个地方：`生产者端`和`broker端`

一般建议在生产者端启用压缩，但是有些情况下也会导致broker端对消息重新进行压缩：

- broker端指定了和producer端不同的压缩算法。
- broker端发生了消息格式转换。



## 何时解压缩

解压缩可能发送在两个地方：`消费者端`和`broker端`

一般consumer端读取到消息集合时会按对应的解压缩算法进行解压，但是有些情况下也会导致broker端解压缩消息：

- broker端要进行格式转换
- 对消息执行各种认证



## 小结

**producer端压缩、broker端保持、consumer端解压缩**

尽量保证不要出现消息格式转换的情况。
