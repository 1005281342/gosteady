## 位移主题

**位移主题**是用来保存Kafka消费者位移信息的。其消息格式是Kafka自己定义的，用户不能修改，随意写入不满足规定的格式可能造成Broker崩溃。位移主题是内部主题，由Kafka自身管理，用户不要随意向该主题发送消息。



## 为什么引入“位移主题”

老版本Consumer的位移管理是基于zookeeper实现的，但是这种方案并不适合高频写场景。针对这种情况，新版本Consumer的位移管理机制，将Consumer的位移数据作为一条消息，提交到`__consumer_offsets`。



## 位移主题的消息

位移主题处理的消息有3种：

1. 上报消费者位移的消息
2. 保存consumer group信息的消息
3. 删除group过期位移、删除group的消息



## 写入时机

**当Kafka集群中第一个consumer程序启动时，Kafka会自动创建位移主题。**

目前Kafka Consumer提交位移的方式有两种：自动提交位移和手动提交位移。

如果你选择的是**自动提交位移**，意味着只要consumer一直启动着，它就会无限期地向位移主题写入消息。



## 管理策略

为了避免Kafka无限期膨胀，**Kafka提供了专门的后台线程定期地巡检待Compact的主题**，来删除满足条件的数据。