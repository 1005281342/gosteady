# 高可用架构三大核心原理



## FLP 不可能原理



## CAP 原理

### 定义

在分布式系统中，无法同时满足一致性（Consistency）、可用性（Availability）和分区容忍性（Partition tolerance）这三个特性

- 一致性（Consistency）：在分布式系统中的所有节点中，对于任何操作的执行结果都是一致的。换句话说，系统中的所有节点都能够看到相同的数据状态。
- 可用性（Availability）：系统必须对于每个请求都能够给出响应，即系统保持持续的可用性，不会因为节点故障或其他原因导致无法响应客户端请求。
- 分区容忍性（Partition tolerance）：系统能够在网络分区的情况下继续正常运行。网络分区是指分布式系统中的节点之间出现通信故障，导致节点无法相互通信的情况。

备注：

1. `CP` 需要保证一致性，当节点判断分区发生后，需要拒绝服务
2. `AP` 需要保证可用性，当节点判断分区发生后，返回当前节点上已有的数据值

### CAP 的三大限定条件

- 分布式：可能发生网络分区
- 数据存储：通过复制来实现数据共享的存储系统
- 同时满足：无法同时满足 `C`、`A`、`P`

### 细节

#### 复制延迟

节点间的数据复制比如从节点 a 复制到节点 b

理论上 CAP 是忽略（需要容忍）延迟的

#### 描述粒度

CAP 关注的是单个数据，不是整个系统，系统数据可以有的符合 AP、有的符合 CP

#### 更多细节

正常运行情况下，可以满足 CA，但是实际上有很小的时延。

放弃 != 无为，需要为分区恢复后的数据恢复和业务恢复做好准备。

CAP 的 CA 和 ACID 的 CA 定义完全不同，适用的领域也不同。（CAP 是在分布式存储领域的，ACID 是在数据库领域的）

## BASE 原理

### 定义

BASE 是指基本可用（Basically Available）、软状态（Soft State）、最终一致性（Eventual Consistency）

核心思想是即使无法做到强一致性（CAP 的一致性就是强一致性），但应用可以采用适合的方式达到最终一致性。

- Basically Available（BA）：读写操作尽可能的可用，但写操作在冲突的时候可能丢失结果，读操作可能读取到旧的值。
- Soft State（S）：没有一致性的保证，允许系统存在中间状态，而该中间状态不会影响系统整体可用性，这里的中间状态就是 CAP 理论中的数据不一致。
- Eventual Consistency（E）：如果系统运行正常且等待足够长的时间，系统最终将达成一致性的状态。

### BASE 是 CAP 中 AP 方案的延伸

考虑了网络时延和系统恢复正常后的状态。


