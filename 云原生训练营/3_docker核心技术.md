## 从系统架构谈起

### 传统分层架构与微服务架构

![](3_docker核心技术.assets/image-20220912173853718.png)

![](3_docker核心技术.assets/image-20220912174028824.png)

简单系统采用分层架构比较合适，复杂系统采用微服务架构比较合适。简单系统可能会随着业务发展迭代演进变得复杂。

### 微服务改造

#### 分离微服务方法建议

- 审视并发现可以分离的业务逻辑
- 寻找天生隔离的代码模块，可以借助于静态代码分析工具
- 不同并发规模，不同内存需求的模块都可以分离出不同的微服务，此方法可提高资源利用率，节省成本

#### 一些常用的可微服务化的组件: 

- 用户和账户管理
- 授权和会话管理
- 系统配置
- 通知和通讯服务
- 照片，多媒体，元数据等

#### 分解原则

- 基于微服务的大小
- 基于微服务的职责（工作范围）
- 基于微服务的能力

### 微服务间通讯

#### 点对点

![](3_docker核心技术.assets/image-20220912183219884.png)

- 多用于系统内部多组件之间通讯;
- 有大量的重复模块如认证授权;
- 缺少统一规范，如监控，审计等功能;
- 后期维护成本高，服务和服务的依赖关系错综复杂难以管理。

#### API网关

![](3_docker核心技术.assets/image-20220912183255218.png)

- 基于一个轻量级的 message gateway
- 新 API 通过注册至 Gateway 实现
- 整合实现 Common function （如：认证授权、审计日志等）

